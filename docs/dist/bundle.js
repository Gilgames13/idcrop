!function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=9)}([function(e,t,o){"use strict";class i{constructor(e,t){this.x=e,this.y=t}findAngle(e){const t=this.x-e.x,o=this.y-e.y;return Math.atan2(t,o)}move(e,t){this.x+=e,this.y+=t}static findCenter(e){let t=0,o=0;for(const i of e)t+=i.x,o+=i.y;return new i(t/e.length,o/e.length)}static sort(e){const t=this.findCenter(e);return e.sort(function(e,o){return e.findAngle(t)>o.findAngle(t)})}}e.exports=i},function(e,t){function o(e){var t=new Image;return t.src='"'===e.substring(0,1)?e.substring(1,e.length-1):e,new Promise(function(e,o){t.onload=(()=>e(t)),t.onerror=(e=>o(e))})}function i(e){e.preventDefault();const t=void 0!==e.target.files?e.target.files[0]:e.dataTransfer.files[0],o=new FileReader;return o.readAsDataURL(t),new Promise(function(e,i){o.onload=(o=>e({filename:t.name,base64:o.target.result})),o.onerror=(e=>i(e))})}e.exports={loadImage:o,dataURIFromSrc:function(e){var t=document.createElement("canvas"),i=t.getContext("2d");return o(e).then(function(e){return t.width=e.width,t.height=e.height,i.drawImage(e,0,0,t.width,t.height),t.toDataURL()})},getBgSource:function(e){return(e.currentStyle||window.getComputedStyle(e,!1)).backgroundImage.slice(4,-1)},fakeInput:function(e,t){e.style.display="none",t.addEventListener("click",function(t){(t=t||window.event).preventDefault(),e.click()})},dragDropInput:function(e,t,o,n){t.addEventListener("dragenter",function(){t.classList.add("hovered")}),t.addEventListener("dragleave",function(){t.classList.remove("hovered")}),t.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),t.addEventListener("drop",function(e){e.preventDefault(),t.classList.remove("hovered"),i(e).then(e=>{o.innerHTML=e.filename,n.startCroppingArea(e.base64,n)})}),e.addEventListener("change",function(e){i(e).then(e=>{o.innerHTML=e.filename,n.startCroppingArea(e.base64,n)})})},getFile:i}},function(e,t,o){"use strict";const i=o(0);e.exports=class{constructor(e,t){this.container=e,this.canvas=t}drawWithOverlay(e,t,o,i,n,r,s="",a=""){const c=this.canvas.getContext("2d");c.clearRect(0,0,this.canvas.width,this.canvas.height),c.save(),c.fillStyle=t,c.fillRect(0,0,this.canvas.width,this.canvas.height),c.restore(),c.save(),n&&c.setLineDash([5,3]),c.strokeStyle=i,c.lineWidth=r,this.draw(c,e),c.clip(),a||s?!a&&s?(c.fillStyle=s,c.fillRect(0,0,this.canvas.width,this.canvas.height)):c.drawImage(a,0,0,this.canvas.width,this.canvas.height):c.clearRect(0,0,this.canvas.width,this.canvas.height),o&&c.stroke(),c.restore()}draw(e,t){e.beginPath(),e.moveTo(t[0].x,t[0].y);let o=[];for(const i of t.slice(1))e.lineTo(i.x,i.y),o.push([i.x,i.y]);e.closePath()}startResizing(e,t,o){if(!this.isDrawing&&"idwall-handle"===e.target.className){const i=e.target,n=i.offsetWidth,r=parseInt(i.id.substr(10),10),s=this.canvas.getBoundingClientRect();let a=this;document.onmousemove=function(e){let c=e.clientX,l=e.clientY;c<s.left&&(c=s.left),c>s.right-n&&(c=s.right-n),l<s.top&&(l=s.top),l>s.bottom-n&&(l=s.bottom-n),a.resize(i,r,t,c,l,o)}}}resize(e,t,o,n,r,s){const a=this.canvas.getBoundingClientRect(),c=this.container.getBoundingClientRect(),l=e.offsetWidth,d=n-c.left,h=r-c.top,p=n-a.left+l/2,g=r-a.top+l/2;e.style.left=d+"px",e.style.top=h+"px",o[t]=new i(p,g),this.drawWithOverlay(o,s.overlayColor,s.stroke,s.strokeColor,s.strokeDashed,s.strokeWeight);var u=new CustomEvent("resized",{detail:[p,g]});document.dispatchEvent(u)}}},function(e,t,o){"use strict";e.exports=class{constructor(e,t){this.container=t,this.img=e}get realWidth(){return this.img.width}get realHeight(){return this.img.height}get left(){return this.calcDimensions().left}get top(){return this.calcDimensions().top}get width(){return this.calcDimensions().width}get height(){return this.calcDimensions().height}get ratio(){return this.realHeight/this.height}calcDimensions(){const e=this.container.getBoundingClientRect(),t=this.realHeight*e.width/this.realWidth,o=this.realWidth*e.height/this.realHeight;return t<=e.height?{width:e.width,height:t,top:(e.height-t)/2,left:0}:{height:e.height,width:o,top:0,left:(e.width-o)/2}}}},function(e,t,o){"use strict";const i=o(3),n=o(2),r=o(0),s=o(1);e.exports=class{constructor(e,t){this.container=e,this.base64=t,this.canvas=document.createElement("canvas"),this.isDrawing=!1,this.img=""}clearCanvas(){this.isDrawing=!0;const e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),e.clearRect(0,0,this.canvas.width,this.canvas.height)}create(){this.clearCanvas(),this.container.innerHTML="",this.container.style.backgroundImage="url("+this.base64+")",this.container.appendChild(this.canvas);let e=this;return s.loadImage(this.base64).then(function(t){return e.img=new i(t,e.container),e.canvas.width=e.img.width,e.canvas.height=e.img.height,e.canvas.style.left=e.img.left+"px",e.canvas.style.top=e.img.top+"px",e.img})}crop(e,t,o,i){const s=document.createElement("canvas");s.width=this.img.realWidth,s.height=this.img.realHeight;let a=[];for(const e of o)a.push(new r(e.x*this.img.ratio,e.y*this.img.ratio));new n(t,s).drawWithOverlay(a,i.overlayColor,i.stroke,i.strokeColor,i.strokeDashed,i.strokeWeight,i.fillColor,i.showImage?e:i.showImage);var c=s.toDataURL(),l=new CustomEvent("crop",{detail:c});return document.dispatchEvent(l),c}}},function(e,t,o){"use strict";const i=o(0);e.exports=class{constructor(e,t,o,n){this.parent=e,this.offsetX=t,this.offsetY=o,this.point=new i(n.x+t,n.y+o),this.node=document.createElement("div")}init(e,t){e&&(this.node.className="idwall-handle"),t&&this.node.classList.add(t),this.parent.appendChild(this.node),this.node.style.left=this.point.x-this.node.offsetWidth/2+"px",this.node.style.top=this.point.y-this.node.offsetWidth/2+"px";var o=new CustomEvent("handleCreated",{detail:[this.point.x,this.point.y]});document.dispatchEvent(o)}setDirection(e){for(const[t,o]of e.entries())o.x===this.point.x-this.offsetX&&o.y===this.point.y-this.offsetY&&""===this.node.id&&(this.node.id="direction-"+t)}delete(){this.parent.removeChild(this.node),this.node=document.createElement("div")}}},function(e,t,o){"use strict";const i=o(0),n=o(5),r=o(2),s=o(4),a=o(1);e.exports=class{constructor(e){this.config={numPoints:void 0!==e.numPoints?e.numPoints:4,allowUpload:void 0===e.allowUpload||e.allowUpload,closeButtonSelector:void 0!==e.closeButtonSelector&&e.closeButtonSelector,containers:{displayArea:document.querySelector(e.displaySelector),toolbarArea:e.toolbarSelector?document.querySelector(e.toolbarSelector):"",previewArea:e.previewSelector?document.querySelector(e.previewSelector):""},croppingArea:{overlayColor:void 0!==e.croppingArea&&void 0!==e.croppingArea.overlayColor?e.croppingArea.overlayColor:"rgba(0, 0, 0, 0.7)",stroke:void 0===e.croppingArea||void 0===e.croppingArea.stroke||e.croppingArea.stroke,strokeColor:void 0!==e.croppingArea&&void 0!==e.croppingArea.strokeColor?e.croppingArea.strokeColor:"white",strokeDashed:void 0===e.croppingArea||void 0===e.croppingArea.strokeDashed||e.croppingArea.strokeDashed,strokeWeight:void 0!==e.croppingArea&&void 0!==e.croppingArea.strokeWeight?e.croppingArea.strokeWeight:2},crop:{overlayColor:void 0!==e.crop&&void 0!==e.crop.overlayColor?e.crop.overlayColor:"rgba(0, 0, 0, 0)",fillColor:void 0!==e.crop&&void 0!==e.crop.fillColor&&e.crop.fillColor,showImage:void 0===e.crop||void 0===e.crop.showImage||e.crop.showImage,stroke:void 0===e.crop||void 0===e.crop.stroke||e.crop.stroke,strokeColor:void 0!==e.crop&&void 0!==e.crop.strokeColor&&e.crop.strokeColor,strokeDashed:void 0!==e.crop&&void 0!==e.crop.strokeDashed&&e.crop.strokeDashed,strokeWeight:void 0!==e.crop&&void 0!==e.crop.strokeWeight?e.crop.strokeWeight:0},handles:{class:void 0!==e.handles&&void 0!==e.handles.class?e.handles.class:"",defaultStyles:void 0===e.handles||void 0===e.handles.defaultStyles||e.handles.defaultStyles}},this.handles=[],this.points=[]}init(){const e=this,t=this.config.containers;if(t.displayArea.classList.add("idwall-display"),t.previewArea&&t.previewArea.classList.add("idwall-preview"),t.toolbarArea&&this.config.numPoints===1/0){var o="";if(this.config.closeButtonSelector)o=document.querySelector(this.config.closeButtonSelector);else{o=document.createElement("button");var i=document.createTextNode("Close path");o.appendChild(i),t.toolbarArea.appendChild(o)}o.addEventListener("click",function(){e.startCroppingPolygon()})}if(t.toolbarArea&&this.config.allowUpload){var n=document.createElement("p"),r=document.createTextNode("Drop files here or "),s=document.createElement("a"),c=document.createTextNode("Browse...");s.title="Browse",s.href="",s.appendChild(c),n.appendChild(r),n.appendChild(s),t.displayArea.appendChild(n);var l=document.createElement("p");l.appendChild(document.createTextNode("No file selected.")),t.toolbarArea.appendChild(l);var d=document.createElement("input");d.type="file",t.toolbarArea.appendChild(d),a.fakeInput(d,s),a.dragDropInput(d,t.displayArea,l,this)}if(!t.toolbarArea||!this.config.allowUpload){var h=a.getBgSource(t.displayArea);a.dataURIFromSrc(h).then(function(t){e.startCroppingArea(t,e)})}window.addEventListener("mouseup",function(){e.config.containers.previewArea&&e.drawPreview(e),document.onmousemove=function(){}});var p=new CustomEvent("created",{detail:e.config});document.dispatchEvent(p)}startCroppingArea(e,t){const o=t.config.containers.displayArea;t.cropArea=new s(o,e),t.cropArea.create().then(function(i){t.image=i,o.style.backgroundImage="url('"+e+"')"});for(const e of t.handles)e.deleteNode();t.handles=[],t.cropArea.canvas.addEventListener("mousedown",function(e){t.createHandles(e,t)})}createHandles(e,t){if(t.cropArea.isDrawing){const o=t.cropArea.canvas.getBoundingClientRect(),r=e.clientX-o.left,s=e.clientY-o.top;let a=new i(r,s),c=new n(t.config.containers.displayArea,t.image.left,t.image.top,a);c.init(t.config.handles.defaultStyles,t.config.handles.class),t.handles.push(c),t.points.push(a),t.handles.length==t.config.numPoints&&t.startCroppingPolygon(t)}}startCroppingPolygon(e=this){const t=e.config.croppingArea;e.points=i.sort(e.points),e.cropArea.isDrawing=!1,e.cropPolygon=new r(e.config.containers.displayArea,e.cropArea.canvas),e.cropPolygon.drawWithOverlay(e.points,t.overlayColor,t.stroke,t.strokeColor,t.strokeDashed,t.strokeWeight);for(const t of e.handles){const o=e.config.croppingArea;t.direction=t.setDirection(e.points),t.node.addEventListener("mousedown",function(t){e.cropPolygon.startResizing(t,e.points,o)})}e.drawPreview(e)}drawPreview(e){if(void 0!==this.cropArea&&0==this.cropArea.isDrawing){const t=this.cropArea.crop(this.image.img,this.config.containers.previewArea,this.points,this.config.crop);e.config.containers.previewArea.style.backgroundImage="url('"+t+"')"}}reset(){this.cropArea=void 0,this.cropPolygon=void 0,this.handles=[],this.points=[],this.image="data:image/jpeg;base64,",this.previewArea&&(this.previewArea.style.backgroundImage=""),this.init()}getPoints(){let e=[];for(const t of this.points)e.push(new i(t.x*this.image.ratio,t.y*this.image.ratio));return e}}},function(e,t,o){var i=o(6);e.exports=i},function(e,t,o){new(o(7))({displaySelector:"#display",toolbarSelector:"#toolbar",previewSelector:"#preview"}).init()},function(e,t,o){o(8)}]);